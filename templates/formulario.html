<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clasificador de Insectos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            forest: '#134e4a',
            leaf: '#10b981',
            sky: '#e0f2fe',
            dusk: '#475569'
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: radial-gradient(ellipse at top left, #e0f2fe, #f0fdf4);
    }
  </style>
</head>
<body class="min-h-screen font-sans text-dusk">
  <header class="bg-forest text-white py-6 shadow-md">
    <div class="max-w-4xl mx-auto px-4 flex flex-col sm:flex-row justify-between items-center">
      <h1 class="text-3xl font-bold tracking-wide">Clasificador de Insectos</h1>
      <p class="text-sm opacity-80 mt-2 sm:mt-0">Usando inteligencia artificial</p>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-10">
    <section class="bg-white shadow-md rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-6 border-b pb-2 text-leaf flex items-center gap-2">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1..."/></svg>
        Ingresar datos del insecto
      </h2>

      <form id="formulario" onsubmit="clasificarInsecto(event)" class="grid gap-6">
        <div>
          <label for="abdomen" class="block text-sm font-medium mb-1">Longitud del Abdomen (mm)</label>
          <input type="number" id="abdomen" name="abdomen" step="0.1" required placeholder="Ej: 12.5"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-leaf focus:outline-none">
        </div>

        <div>
          <label for="antena" class="block text-sm font-medium mb-1">Longitud de las Antenas (mm)</label>
          <input type="number" id="antena" name="antena" step="0.1" required placeholder="Ej: 8.7"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-leaf focus:outline-none">
        </div>

        <div class="flex flex-col sm:flex-row gap-4">
          <button type="submit" id="submitBtn" class="bg-leaf text-white px-6 py-3 rounded-lg hover:bg-forest flex-1 transition-colors">
            Clasificar Insecto
          </button>
          <button type="button" onclick="clearForm()" class="bg-gray-100 px-6 py-3 rounded-lg hover:bg-gray-200 flex-1">
            Limpiar
          </button>
        </div>

        <div id="loadingSpinner" class="hidden flex items-center gap-3 text-gray-600">
          <div class="w-5 h-5 border-2 border-leaf border-t-transparent rounded-full animate-spin"></div>
          Analizando insecto...
        </div>
      </form>
    </section>

    <section id="resultado" class="mt-6"></section>
  </main>

  <script>
    function clasificarInsecto(event) {
      event.preventDefault();
      const submitBtn = document.getElementById('submitBtn');
      const resultado = document.getElementById('resultado');
      const spinner = document.getElementById('loadingSpinner');

      submitBtn.disabled = true;
      spinner.classList.remove('hidden');
      resultado.innerHTML = '';

      const abdomen = document.getElementById('abdomen').value;
      const antena = document.getElementById('antena').value;

      if (!abdomen || !antena || isNaN(abdomen) || isNaN(antena)) {
        showError('Por favor, completa todos los campos con valores numéricos.');
        resetButton();
        return;
      }

      fetch('/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `abdomen=${abdomen}&antena=${antena}`
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) showError(data.error);
        else showSuccess(`El insecto es un/a ${data.categoria}`);
      })
      .catch(() => showError('Error en la conexión.'))
      .finally(resetButton);
    }

    function showError(msg) {
      document.getElementById('resultado').innerHTML = `
        <div class="bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg">
          <strong>Error:</strong> ${msg}
        </div>`;
    }

    function showSuccess(msg) {
      document.getElementById('resultado').innerHTML = `
        <div class="bg-green-50 border border-green-200 text-green-700 p-4 rounded-lg">
          <strong>¡Exito!</strong> ${msg}
        </div>`;
    }

    function resetButton() {
      document.getElementById('submitBtn').disabled = false;
      document.getElementById('loadingSpinner').classList.add('hidden');
    }

    function clearForm() {
      document.getElementById('formulario').reset();
      document.getElementById('resultado').innerHTML = '';
    }
  </script>
</body>
</html>